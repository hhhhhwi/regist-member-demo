# 구현 계획

- [x] 1. 핵심 데이터 모델 및 엔티티 구현





  - Customer, Product, Order, OrderSession 엔티티 클래스 작성
  - 기존 User 엔티티에 TeacherAuthLevel 메서드 추가
  - JPA 관계 매핑 및 데이터베이스 스키마 정의
  - _요구사항: 1.1, 1.2, 2.1, 2.2, 3.1, 3.2, 4.1, 4.2, 5.1_

- [x] 2. Repository 계층 구현

  - CustomerRepository 인터페이스 및 커스텀 쿼리 메서드 작성
  - ProductRepository 인터페이스 및 권한별 조회 메서드 작성
  - OrderRepository 인터페이스 및 교사별 주문 조회 메서드 작성
  - OrderSessionRepository 인터페이스 및 세션 관리 메서드 작성
  - _요구사항: 1.6, 1.7, 2.3, 2.4, 4.1, 4.3, 5.1, 5.2_


- [x] 3. 서비스 계층 핵심 비즈니스 로직 구현



- [x] 3.1 CustomerService 구현

  - 고객 검색 기능 (이름, 연락처 기반)
  - 고객 정보 저장 및 조회 기능
  - 중복 고객 확인 로직


  - _요구사항: 1.5, 1.6, 1.7_

- [x] 3.2 ProductService 구현

  - 교사 권한별 상품 필터링 로직


  - 학년/관리유형/패드종류/모델 계층 구조 조회
  - 모델 가격 조회 및 총액 계산 기능
  - _요구사항: 2.1, 2.2, 2.3, 2.4, 2.5, 2.6, 5.1, 5.2, 5.3, 6.1, 6.2, 6.3_

- [x] 3.3 OrderService 구현

  - 3단계 주문 세션 관리 로직
  - 임시 주문 정보 저장 및 조회
  - 최종 주문 생성 및 주문번호 생성
  - 교사별 주문 목록 조회 기능
  - _요구사항: 1.2, 2.7, 3.3, 4.1, 4.2, 4.3_

- [ ] 4. 1단계: 고객 등록 기능 구현
- [x] 4.1 고객 등록 컨트롤러 구현



  - GET /order/step1 엔드포인트 (고객 등록 페이지)
  - POST /order/step1 엔드포인트 (고객 정보 임시 저장)
  - 유효성 검사 및 에러 처리
  - _요구사항: 1.1, 1.2, 1.3, 1.4_

- [x] 4.2 고객 검색 팝업 기능 구현

  - GET /customer/search 엔드포인트 (검색 팝업)
  - POST /customer/search 엔드포인트 (검색 실행)
  - Ajax 기반 비동기 검색 처리
  - _요구사항: 1.5, 1.6, 1.7_

- [x] 4.3 고객 등록 Thymeleaf 템플릿 작성




  - 부모 정보 입력 폼 (이름, 연락처, 이메일, 주소)
  - 자녀 정보 입력 폼 (이름, 학년, 학교)
  - 고객 검색 버튼 및 팝업 모달
  - 클라이언트 사이드 유효성 검사 JavaScript
  - _요구사항: 1.1, 1.2, 1.3, 1.5_

- [x] 5. 2단계: 모델 선택 기능 구현




- [x] 5.1 모델 선택 컨트롤러 구현


  - GET /order/step2 엔드포인트 (모델 선택 페이지)
  - POST /order/step2 엔드포인트 (모델 선택 정보 저장)
  - 권한 검사 및 접근 제어 로직
  - _요구사항: 2.1, 2.7, 2.8, 2.9, 5.1, 5.2, 5.3_



- [x] 5.2 계층적 모델 선택 Ajax API 구현

  - GET /api/management-types 엔드포인트 (관리/비관리 옵션)
  - GET /api/pad-types 엔드포인트 (권한별 패드 종류)
  - GET /api/models 엔드포인트 (패드별 모델 목록)
  - GET /api/model-price 엔드포인트 (모델 가격 조회)

  - _요구사항: 2.2, 2.3, 2.4, 2.5, 2.6_

- [x] 5.3 모델 선택 Thymeleaf 템플릿 작성

  - 가입 학년 선택 드롭다운
  - 관리/비관리 라디오 버튼
  - 패드 종류 선택 드롭다운 (동적 로딩)
  - 모델 선택 드롭다운 (동적 로딩)
  - 월회비 실시간 표시 및 총액 계산 JavaScript
  - _요구사항: 2.1, 2.2, 2.3, 2.4, 2.5, 2.6, 6.1, 6.2, 6.3_

- [ ] 6. 3단계: 주문 확인 및 등록 기능 구현
- [ ] 6.1 주문 확인 컨트롤러 구현
  - GET /order/step3 엔드포인트 (주문 확인 페이지)
  - POST /order/step3 엔드포인트 (최종 주문 등록)
  - 주문 완료 후 리다이렉트 처리
  - _요구사항: 3.1, 3.2, 3.3, 3.4_

- [ ] 6.2 주문 확인 Thymeleaf 템플릿 작성
  - 고객 정보 표시 (부모 정보 + 자녀 정보)
  - 선택된 모델 정보 표시 (학년, 관리유형, 패드, 모델, 월회비, 수량, 총액)
  - 이전 단계 돌아가기 버튼
  - 최종 등록 버튼
  - _요구사항: 3.1, 3.2, 3.4_

- [ ] 7. 주문 조회 기능 구현
- [ ] 7.1 주문 목록 컨트롤러 구현
  - GET /order/list 엔드포인트 (주문 목록 페이지)
  - GET /order/{id} 엔드포인트 (주문 상세 페이지)
  - 교사별 주문 필터링 및 권한 검사
  - _요구사항: 4.1, 4.2, 4.3, 7.2_

- [ ] 7.2 주문 목록 및 상세 Thymeleaf 템플릿 작성
  - 주문 목록 테이블 (주문번호, 부모명, 자녀명, 모델명, 수량, 총액, 주문일시, 상태)
  - 주문 상세 정보 페이지 (고객 정보 + 모델 정보 + 주문 정보)
  - 페이지네이션 및 검색 기능
  - _요구사항: 4.2, 4.3_

- [ ] 8. 예외 처리 및 보안 강화
- [ ] 8.1 커스텀 예외 클래스 및 글로벌 예외 처리기 구현
  - OrderException, CustomerNotFoundException, UnauthorizedProductAccessException 클래스 작성
  - @ControllerAdvice 기반 글로벌 예외 처리기 구현
  - 에러 페이지 템플릿 작성
  - _요구사항: 5.3, 7.1, 7.2, 7.3_

- [ ] 8.2 보안 설정 업데이트
  - SecurityConfig에 주문 관련 URL 패턴 추가
  - JWT 인증 필터에서 주문 권한 검사 로직 추가
  - CSRF 토큰 설정 및 XSS 방지 처리
  - _요구사항: 7.1, 7.2, 7.3_

- [ ] 9. 테스트 데이터 및 초기화
- [ ] 9.1 테스트 데이터 생성 스크립트 작성
  - 샘플 고객 데이터 생성
  - 다양한 권한 레벨별 상품 데이터 생성
  - 테스트용 주문 데이터 생성
  - data.sql 또는 @PostConstruct 기반 데이터 로더 구현

- [ ] 9.2 애플리케이션 설정 업데이트
  - application.properties에 JPA 설정 추가
  - H2 데이터베이스 스키마 자동 생성 설정
  - 로깅 설정 및 개발 환경 구성

- [ ] 10. 단위 테스트 작성
- [ ] 10.1 Service 계층 단위 테스트
  - CustomerService 테스트 (검색, 저장, 조회)
  - ProductService 테스트 (권한별 필터링, 가격 계산)
  - OrderService 테스트 (주문 생성, 세션 관리)
  - _요구사항: 1.5, 1.6, 1.7, 2.3, 2.4, 2.5, 3.3, 5.1, 5.2, 6.1, 6.2_

- [ ] 10.2 Repository 계층 테스트
  - @DataJpaTest 기반 Repository 테스트
  - 커스텀 쿼리 메서드 검증
  - 데이터베이스 제약조건 및 관계 매핑 테스트

- [ ] 11. 통합 테스트 및 E2E 테스트
- [ ] 11.1 Controller 통합 테스트
  - @WebMvcTest 기반 컨트롤러 테스트
  - MockMvc를 사용한 HTTP 요청/응답 테스트
  - JWT 인증 및 권한 검사 테스트
  - _요구사항: 7.1, 7.2, 7.3_

- [ ] 11.2 전체 주문 프로세스 E2E 테스트
  - 3단계 주문 등록 플로우 테스트
  - 세션 데이터 유지 및 단계별 이동 테스트
  - 권한별 상품 접근 제어 테스트
  - _요구사항: 1.1-1.7, 2.1-2.9, 3.1-3.4, 5.1-5.3_